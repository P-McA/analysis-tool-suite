<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIX Message Comparison Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Add Tailwind CSS for React component styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .fix-message {
            font-family: monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }
        .party-role-block {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 2px 4px;
            font-weight: 500;
        }
        .party-role-value {
            font-family: monospace;
            font-size: 0.85rem;
            color: #1565c0;
        }
    </style>

    <!-- Embed FIX fields definitions directly -->
    <script>
    // FIX Protocol Fields - Generated from https://fiximate.fixtrading.org/en/FIX.Latest/fields_sorted_by_tagnum.html
    const fixFieldMap = {
      '1': 'Account',
      '2': 'AdvId',
      '3': 'AdvRefID',
      '4': 'AdvSide',
      '5': 'AdvTransType',
      '6': 'AvgPx',
      '7': 'BeginSeqNo',
      '8': 'BeginString',
      '9': 'BodyLength',
      '10': 'CheckSum',
      '11': 'ClOrdID',
      '12': 'Commission',
      '13': 'CommType',
      '14': 'CumQty',
      '15': 'Currency',
      '16': 'EndSeqNo',
      '17': 'ExecID',
      '18': 'ExecInst',
      '19': 'ExecRefID',
      '20': 'HandlInst',
      '21': 'SecurityIDSource',
      '22': 'SecurityIDSource',
      '23': 'IOIid',
      '24': 'IOIOthSvc',
      '25': 'IOIQltyInd',
      '26': 'IOIRefID',
      '27': 'IOIQty',
      '28': 'IOITransType',
      '29': 'LastCapacity',
      '30': 'LastMkt',
      '31': 'LastPx',
      '32': 'LastQty',
      '33': 'LinesOfText',
      '34': 'MsgSeqNum',
      '35': 'MsgType',
      '36': 'NewSeqNo',
      '37': 'OrderID',
      '38': 'OrderQty',
      '39': 'OrdStatus',
      '40': 'OrdType',
      '41': 'OrigClOrdID',
      '42': 'OrigTime',
      '43': 'PossDupFlag',
      '44': 'Price',
      '45': 'RefSeqNum',
      '46': 'RelatdSym',
      '47': 'Rule80A',
      '48': 'SecurityID',
      '49': 'SenderCompID',
      '50': 'SenderSubID',
      '51': 'SendingTime',
      '52': 'SendingTime',
      '53': 'Quantity',
      '54': 'Side',
      '55': 'Symbol',
      '56': 'TargetCompID',
      '57': 'TargetSubID',
      '58': 'Text',
      '59': 'TimeInForce',
      '60': 'TransactTime',
      '61': 'Urgency',
      '62': 'ValidUntilTime',
      '63': 'SettlType',
      '64': 'SettlDate',
      '65': 'SymbolSfx',
      '66': 'ListID',
      '67': 'ListSeqNo',
      '68': 'TotNoOrders',
      '69': 'ListExecInst',
      '70': 'AllocID',
      '71': 'AllocTransType',
      '72': 'RefAllocID',
      '73': 'NoOrders',
      '74': 'AvgPxPrecision',
      '75': 'TradeDate',
      '76': 'PositionEffect',
      '77': 'NoAllocs',
      '78': 'AllocAccount',
      '79': 'AllocQty',
      '80': 'ProcessCode',
      '81': 'NoRpts',
      '82': 'RptSeq',
      '83': 'CxlQty',
      '84': 'NoDlvyInst',
      '85': 'DlvyInst',
      '86': 'AllocStatus',
      '87': 'AllocRejCode',
      '88': 'Signature',
      '89': 'SecureDataLen',
      '90': 'SecureData',
      '91': 'SignatureLength',
      '92': 'EmailType',
      '93': 'RawDataLength',
      '94': 'RawData',
      '95': 'PossResend',
      '96': 'EncryptMethod',
      '97': 'StopPx',
      '98': 'ExDestination',
      '99': 'CxlRejReason',
      '100': 'OrdRejReason',
      '102': 'CxlRejResponseTo',
      '103': 'OrdRejReason',
      '104': 'IOIQualifier',
      '105': 'WaveNo',
      '106': 'Issuer',
      '107': 'SecurityDesc',
      '108': 'HeartBtInt',
      '109': 'ClientID',
      '110': 'MinQty',
      '111': 'MaxFloor',
      '112': 'TestReqID',
      '113': 'ReportToExch',
      '114': 'LocateReqd',
      '115': 'OnBehalfOfCompID',
      '116': 'OnBehalfOfSubID',
      '117': 'QuoteID',
      '118': 'NetMoney',
      '119': 'SettlCurrAmt',
      '120': 'SettlCurrency',
      '121': 'ForexReq',
      '122': 'OrigSendingTime',
      '123': 'GapFillFlag',
      '124': 'NoExecs',
      '125': 'ExpireTime',
      '126': 'DKReason',
      '127': 'DeliverToCompID',
      '128': 'DeliverToSubID',
      '129': 'IOINaturalFlag',
      '130': 'QuoteReqID',
      '131': 'QuoteAckStatus',
      '132': 'DKReason',
      '133': 'ReportToExch',
      '134': 'CxlRejResponseTo',
      '135': 'DisplayQty',
      '136': 'NoMiscFees',
      '137': 'MiscFeeAmt',
      '138': 'MiscFeeCurr',
      '139': 'MiscFeeType',
      '140': 'PrevClosePx',
      '141': 'ResetSeqNumFlag',
      '142': 'SenderLocationID',
      '143': 'TargetLocationID',
      '144': 'OnBehalfOfLocationID',
      '145': 'DeliverToLocationID',
      '146': 'NoRelatedSym',
      '147': 'Subject',
      '148': 'Headline',
      '149': 'URLLink',
      '150': 'ExecType',
      '151': 'LeavesQty',
      '152': 'CashOrderQty',
      '153': 'AllocAvgPx',
      '154': 'AllocNetMoney',
      '155': 'SettlCurrFxRate',
      '156': 'SettlCurrFxRateCalc',
      '157': 'NumDaysInterest',
      '158': 'AccruedInterestRate',
      '159': 'AccruedInterestAmt',
      '160': 'SettlInstMode',
      '161': 'AllocText',
      '162': 'SettlInstID',
      '163': 'SettlInstTransType',
      '164': 'EmailThreadID',
      '165': 'SettlInstSource',
      '166': 'SettlLocation',
      '167': 'SecurityType',
      '168': 'EffectiveTime',
      '169': 'StandInstDbType',
      '170': 'StandInstDbName',
      '171': 'StandInstDbID',
      '172': 'SettlDeliveryType',
      '173': 'SettlDepositoryCode',
      '174': 'SettlBrkrCode',
      '175': 'SettlInstCode',
      '176': 'SecuritySettlAgentName',
      '177': 'SecuritySettlAgentCode',
      '178': 'SecuritySettlAgentAcctNum',
      '179': 'SecuritySettlAgentAcctName',
      '180': 'SecuritySettlAgentContactName',
      '181': 'SecuritySettlAgentContactPhone',
      '182': 'CashSettlAgentName',
      '183': 'CashSettlAgentCode',
      '184': 'CashSettlAgentAcctNum',
      '185': 'CashSettlAgentAcctName',
      '186': 'CashSettlAgentContactName',
      '187': 'CashSettlAgentContactPhone',
      '188': 'BidSpotRate',
      '189': 'BidForwardPoints',
      '190': 'OfferSpotRate',
      '191': 'OfferForwardPoints',
      '192': 'OrderQty2',
      '193': 'SettlDate2',
      '194': 'LastSpotRate',
      '195': 'LastForwardPoints',
      '196': 'AllocLinkID',
      '197': 'AllocLinkType',
      '198': 'SecondaryOrderID',
      '199': 'NoIOIQualifiers',
      '200': 'MaturityMonthYear',
      '201': 'PutOrCall',
      '202': 'StrikePrice',
      '203': 'CoveredOrUncovered',
      '204': 'OptAttribute',
      '205': 'SecurityExchange',
      '206': 'NotifyBrokerOfCredit',
      '207': 'AllocHandlInst',
      '208': 'MaxShow',
      '209': 'PegOffsetValue',
      '210': 'AllocTransType',
      '211': 'NoRoutingIDs',
      '212': 'RoutingType',
      '213': 'RoutingID',
      '214': 'SpreadToBenchmark',
      '215': 'Benchmark',
      '216': 'CouponRate',
      '217': 'CouponPaymentDate',
      '218': 'IssueDate',
      '219': 'RepurchaseTerm',
      '220': 'RepurchaseRate',
      '221': 'Factor',
      '222': 'TradeOriginationDate',
      '223': 'ExDate',
      '224': 'ContractMultiplier',
      '225': 'NoStipulations',
      '226': 'StipulationType',
      '227': 'StipulationValue',
      '228': 'YieldType',
      '229': 'Yield',
      '230': 'TotalTakedown',
      '231': 'Concession',
      '232': 'RepoCollateralSecurityType',
      '233': 'RepurchaseTerm',
      '234': 'RepurchaseRate',
      '235': 'Factor',
      '236': 'RepoCollateralSecurityType',
      '237': 'RepurchaseTerm',
      '238': 'RepurchaseRate',
      '239': 'Factor',
      '240': 'RedemptionDate',
      '241': 'CreditRating',
      '242': 'UnderlyingCouponPaymentDate',
      '243': 'UnderlyingIssueDate',
      '244': 'UnderlyingRepoCollateralSecurityType',
      '245': 'UnderlyingRepurchaseTerm',
      '246': 'UnderlyingRepurchaseRate',
      '247': 'UnderlyingFactor',
      '248': 'UnderlyingRedemptionDate',
      '249': 'LegCouponPaymentDate',
      '250': 'LegIssueDate',
      '251': 'LegRepoCollateralSecurityType',
      '252': 'LegRepurchaseTerm',
      '253': 'LegRepurchaseRate',
      '254': 'LegFactor',
      '255': 'LegRedemptionDate',
      '256': 'CreditRating',
      '257': 'UnderlyingCreditRating',
      '258': 'LegCreditRating',
      '259': 'TradedFlatSwitch',
      '260': 'BasisFeatureDate',
      '261': 'BasisFeaturePrice',
      '262': 'QuoteStatus',
      '263': 'LegQty',
      '264': 'LegSwapType',
      '265': 'LegSettlType',
      '266': 'LegSettlDate',
      '267': 'LegPriceType',
      '268': 'LegBidPx',
      '269': 'LegOfferPx',
      '270': 'TradingSessionID',
      '271': 'TradSesMethod',
      '272': 'TradSesMode',
      '273': 'TradSesStatus',
      '274': 'TradSesStartTime',
      '275': 'TradSesOpenTime',
      '276': 'TradSesPreCloseTime',
      '277': 'TradSesCloseTime',
      '278': 'TradSesEndTime',
      '279': 'FeeMultiplier',
      '280': 'AllocStatus',
      '281': 'AllocRejCode',
      '282': 'AllocLinkType',
      '283': 'AllocLinkID',
      '284': 'AllocAvgPx',
      '285': 'AllocNetMoney',
      '286': 'AllocSettlCurrAmt',
      '287': 'AllocSettlCurrency',
      '288': 'AllocSettlCurrFxRate',
      '289': 'AllocSettlCurrFxRateCalc',
      '290': 'AllocAccruedInterestAmt',
      '291': 'AllocInterestAtMaturity',
      '292': 'NoOrders',
      '293': 'AvgPrxPrecision',
      '294': 'TradeOriginationDate',
      '295': 'ExDate',
      '296': 'ContractMultiplier',
      '297': 'TradedFlatSwitch',
      '298': 'BasisFeatureDate',
      '299': 'BasisFeaturePrice',
      '300': 'ConcessionAmount',
      '301': 'TotalTakedownAmount',
      '302': 'NetMoney',
      '303': 'SettlCurrAmt',
      '304': 'SettlCurrency',
      '305': 'SettlCurrFxRate',
      '306': 'SettlCurrFxRateCalc',
      '307': 'AllocAvgPx',
      '308': 'AllocNetMoney',
      '309': 'AllocSettlCurrAmt',
      '310': 'AllocSettlCurrency',
      '311': 'AllocSettlCurrFxRate',
      '312': 'ProcessCode',
      '313': 'NoStipulations',
      '314': 'StipulationType',
      '315': 'StipulationValue',
      '316': 'YieldType',
      '317': 'Yield',
      '318': 'TotalTakedown',
      '319': 'Concession',
      '320': 'CreditRating',
      '321': 'UnderlyingCreditRating',
      '322': 'LegCreditRating',
      '323': 'QuoteRequestType',
      '324': 'QuoteType',
      '325': 'QuoteResponseLevel',
      '326': 'QuoteRequestRejectReason',
      '327': 'QuoteRejectReason',
      '328': 'QuoteCancelType',
      '329': 'QuoteStatus',
      '330': 'QuoteSizeType',
      '331': 'QuoteRespID',
      '332': 'QuoteRespType',
      '333': 'UnderlyingIDSource',
      '334': 'QuoteRequestRejectReason',
      '335': 'QuoteRejectReason',
      '336': 'QuoteCancelType',
      '337': 'QuoteStatus',
      '338': 'QuoteSizeType',
      '339': 'QuoteRespID',
      '340': 'QuoteRespType',
      '341': 'UnderlyingSymbol',
      '342': 'UnderlyingSymbolSfx',
      '343': 'UnderlyingSecurityID',
      '344': 'UnderlyingIDSource',
      '345': 'UnderlyingSecurityType',
      '346': 'UnderlyingMaturityMonthYear',
      '347': 'UnderlyingPutOrCall',
      '348': 'UnderlyingStrikePrice',
      '349': 'UnderlyingOptAttribute',
      '350': 'UnderlyingCurrency',
      '351': 'RatioQty',
      '352': 'SecurityExchange',
      '353': 'UnderlyingSecurityExchange',
      '354': 'CxlRejReason',
      '355': 'UnderlyingCouponRate',
      '356': 'UnderlyingContractMultiplier',
      '357': 'ContraTradeQty',
      '358': 'ContraTradeTime',
      '359': 'ClearingFirm',
      '360': 'ClearingAccount',
      '361': 'LiquidityNumSecurities',
      '362': 'MultiLegReportingType',
      '363': 'StrategyParameterName',
      '364': 'StrategyParameterType',
      '365': 'StrategyParameterValue',
      '366': 'Price2',
      '367': 'PriceType',
      '368': 'DayOrderQty',
      '369': 'DayCumQty',
      '370': 'DayAvgPx',
      '371': 'GTBookingInst',
      '372': 'TradeDate',
      '373': 'TransactTime',
      '374': 'ReportID',
      '375': 'RepurchaseTerm',
      '376': 'RepurchaseRate',
      '377': 'Factor',
      '378': 'TradeOriginationDate',
      '379': 'ExDate',
      '380': 'ContractMultiplier',
      '381': 'NoTradingSessions',
      '382': 'TradingSessionID',
      '383': 'ContraTrader',
      '384': 'TradingSessionSubID',
      '385': 'TotalVolumeTraded',
      '386': 'NoUnderlyings',
      '387': 'UnderlyingSymbol',
      '388': 'UnderlyingSymbolSfx',
      '389': 'UnderlyingSecurityID',
      '390': 'UnderlyingIDSource',
      '391': 'NoUnderlyingSecurityAltID',
      '392': 'UnderlyingSecurityAltID',
      '393': 'UnderlyingSecurityAltIDSource',
      '394': 'UnderlyingProduct',
      '395': 'UnderlyingCFICode',
      '396': 'UnderlyingSecurityType',
      '397': 'UnderlyingMaturityMonthYear',
      '398': 'UnderlyingPutOrCall',
      '399': 'UnderlyingStrikePrice',
      '400': 'UnderlyingOptAttribute',
      '401': 'UnderlyingSecurityExchange',
      '402': 'UnderlyingIssuer',
      '403': 'EncodedUnderlyingIssuerLen',
      '404': 'EncodedUnderlyingIssuer',
      '405': 'UnderlyingSecurityDesc',
      '406': 'EncodedUnderlyingSecurityDescLen',
      '407': 'EncodedUnderlyingSecurityDesc',
      '408': 'UnderlyingCPProgram',
      '409': 'UnderlyingCPRegType',
      '410': 'UnderlyingCurrency',
      '411': 'UnderlyingQty',
      '412': 'UnderlyingSettlementType',
      '413': 'UnderlyingCashAmount',
      '414': 'UnderlyingCashType',
      '415': 'UnderlyingPx',
      '416': 'UnderlyingDirtyPrice',
      '417': 'UnderlyingEndPrice',
      '418': 'UnderlyingStartValue',
      '419': 'UnderlyingCurrentValue',
      '420': 'UnderlyingEndValue',
      '421': 'UnderlyingAdjustedQuantity',
      '422': 'NoUnderlyingStips',
      '423': 'PriceType',
      '424': 'UnderlyingStipValue',
      '425': 'UnderlyingAllocationPercent',
      '426': 'UnderlyingSettlementType',
      '427': 'UnderlyingCashAmount',
      '428': 'UnderlyingCashType',
      '429': 'UnderlyingUnitOfMeasure',
      '430': 'UnderlyingTimeUnit',
      '431': 'UnderlyingCapValue',
      '432': 'UnderlyingSettlMethod',
      '433': 'UnderlyingPutOrCall',
      '434': 'UnderlyingContractMultiplier',
      '435': 'UnderlyingUnitOfMeasure',
      '436': 'UnderlyingTimeUnit',
      '437': 'UnderlyingExerciseStyle',
      '438': 'UnderlyingCouponRate',
      '439': 'UnderlyingSecurityExchange',
      '440': 'UnderlyingIssuer',
      '441': 'UnderlyingSecurityDesc',
      '442': 'MultiLegReportingType',
      '443': 'UnderlyingSecurityID',
      '444': 'UnderlyingSecurityType',
      '445': 'UnderlyingSymbol',
      '446': 'UnderlyingSymbolSfx',
      '447': 'PartyIDSource',
      '448': 'PartyID',
      '451': 'UnderlyingIDSource',
      '452': 'PartyRole',
      '453': 'NoPartyIDs',
      '455': 'SecurityAltID',
      '456': 'SecurityAltIDSource',
      '461': 'CFICode',
      '462': 'FillExecID',
      '463': 'FillPx',
      '464': 'FillQty',
      '487': 'TradeReportTransType',
      '523': 'PartySubID',
      '526': 'SideSecondaryClOrdID',
      '527': 'SecondaryExecID',
      '552': 'TrdCapRptSideGrp',
      '555': 'TrdInstrmtLegGrp',
      '556': 'DerivativeSecurityStatus',
      '557': 'DerivativeInstrRegistry',
      '558': 'DerivativeCountryOfIssue',
      '559': 'DerivativeStateOrProvinceOfIssue',
      '560': 'DerivativeLocaleOfIssue',
      '561': 'DerivativeStrikeMultiplier',
      '562': 'DerivativeStrikeCurrency',
      '563': 'DerivativeUnitOfMeasure',
      '564': 'DerivativeUnitOfMeasureQty',
      '565': 'DerivativeTimeUnit',
      '566': 'DerivativeSecurityExchange',
      '567': 'DerivativePositionLimit',
      '568': 'TradeRequestID',
      '569': 'DerivativeEncodedIssuerLen',
      '570': 'DerivativeEncodedIssuer',
      '571': 'TradeReportID',
      '578': 'TradeInputSource',
      '582': 'CustOrderCapacity',
      '600': 'LegSymbol',
      '602': 'LegSecurityID',
      '603': 'LegSecurityIDSource',
      '605': 'LegSecurityAltID',
      '606': 'LegSecurityAltIDSource',
      '608': 'LegCFICode',
      '609': 'LegSecurityType',
      '616': 'LegSecurityExchange',
      '620': 'LegSecurityDesc',
      '624': 'LegSide',
      '637': 'LegLastPx',
      '654': 'LegRefID',
      '686': 'LegPriceType',
      '687': 'LegQty',
      '711': 'UndInstrmtGrp',
      '715': 'ClearingBusinessDate',
      '762': 'SecuritySubType',
      '779': 'LastUpdateTime',
      '800': 'AllocSettlInstType',
      '801': 'AllocAcctIDSource',
      '802': 'NoPartySubIDs',
      '803': 'PartySubIDType',
      '810': 'UnderlyingPx',
      '828': 'TrdType',
      '830': 'TransferReason',
      '856': 'TradeReportType',
      '880': 'TrdMatchID',
      '882': 'UnderlyingDirtyPrice',
      '916': 'StartDate',
      '917': 'EndDate',
      '921': 'StartCash',
      '922': 'EndCash',
      '939': 'TrdRptStatus',
      '990': 'LegReportID',
      '1003': 'TradeID',
      '1012': 'SideTrdRegTimestamp',
      '1013': 'SideTrdRegTimestampType',
      '1016': 'SideTrdRegTS',
      '1040': 'SecondaryTradeID',
      '1057': 'AggressorIndicator',
      '1152': 'LegNumber',
      '1430': 'VenueType',
      '1500': 'MDStreamID',
      '1832': 'ClearedIndicator',
      '1851': 'StrategyLinkID',
      '1855': 'RelatedTradeGrp',
      '1856': 'RelatedTradeID',
      '1857': 'RelatedTradeIDSource',
      '2639': 'CommissionDataGrp',
      '2640': 'Commission Amount',
      '2642': 'Commission Basis',
      '2646': 'Commission Rate',
      '2649': 'Commission Leg Ref ID',
      '2668': 'TrdRegPublicationGrp',
      '2669': 'TrdRegPublicationType',
      '2670': 'TrdRegPublicationReason',
      '2490': 'TradeNumber',
      '5106': 'FundDesignation',
      '5149': 'Memo',
      '9373': 'LiquidityFlag',
      '10024': 'DifferentialPriceType',
      '10026': 'PriceQuoteCurrency',
      '10027': 'Side Regulatory Trade ID',
      '10028': 'Side Regulatory Trade ID Source',
      '10029': 'Side Regulatory Trade ID Event',
      '10030': 'Side Regulatory Trade ID Type',
      '10033': 'DifferentialPrice',
      '10034': 'SideRegulatoryTradeIDGrp',
      '10036': 'PackageID',
      '10039': 'SideOrigTradeID',
      '10053': 'SplitIndicator',
      '10055': 'LegAlternatePrice',
      '10056': 'LegInstrumentGUID',
      '20011': 'DealID',
      '20043': 'AlternatePrice',
      '20056': 'SettlementTradeID',
      '20060': 'VenueSubType',
      '20400': 'NonDisclosedIndicator',
      '37513': 'GUID',
      '37711': 'MarketDataTradeEntryID'
    };

    // Function to get field name for a tag
    function getFieldName(tag) {
      return fixFieldMap[tag] || `Field(${tag})`;
    }
    </script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">FIX Message Comparison Tool</h1>
        <div id="root" class="mb-4"></div>
    </div>

    <!-- React and Related Libraries -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- FIX Message Comparison Component -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        const FIXMessageComparison = () => {
          const [execReport, setExecReport] = useState('');
          const [tradeCapture, setTradeCapture] = useState('');
          const [results, setResults] = useState(null);
          const [delimiter, setDelimiter] = useState('|');
          const [loading, setLoading] = useState(false);

          // Parse FIX message string into object with tag-value pairs and group Party Role blocks
          const parseFIXMessage = (message, delim) => {
            if (!message) return {};

            const effectiveDelim = delim || '|';
            const pairs = message.split(effectiveDelim).filter(pair => pair.trim());

            // First, parse all tag-value pairs in sequence
            const tagSequence = [];
            pairs.forEach(pair => {
              const [tag, value] = pair.split('=');
              if (tag && value !== undefined) {
                tagSequence.push({ tag: tag.trim(), value: value.trim() });
              }
            });

            // Identify and group Party Role blocks
            const result = {};
            const processedIndices = new Set();
            const partyRoleGroups = [];

            // Find Party Role groups
            tagSequence.forEach((item, index) => {
              if (item.tag === '452' && !processedIndices.has(index)) {
                const group = {
                  role: item.value,
                  partyId: null,
                  src: null,
                  partySubId: null,
                  partySubIdType: null,
                  originalTags: []
                };

                processedIndices.add(index);
                group.originalTags.push(`452=${item.value}`);

                // Look for associated party tags in nearby positions
                // Party blocks can have 448 before or after 452, and other tags nearby
                const searchStart = Math.max(0, index - 5);
                const searchEnd = Math.min(tagSequence.length - 1, index + 5);

                for (let i = searchStart; i <= searchEnd; i++) {
                  if (i === index || processedIndices.has(i)) continue;

                  const currentItem = tagSequence[i];
                  let shouldProcess = false;

                  switch (currentItem.tag) {
                    case '448': // PartyID
                      // Check if this 448 is part of this party role group
                      // Look for the closest 452 to this 448
                      let closest452 = null;
                      let closestDistance = Infinity;

                      for (let j = 0; j < tagSequence.length; j++) {
                        if (tagSequence[j].tag === '452') {
                          const distance = Math.abs(j - i);
                          if (distance < closestDistance) {
                            closestDistance = distance;
                            closest452 = j;
                          }
                        }
                      }

                      if (closest452 === index) {
                        group.partyId = currentItem.value;
                        group.originalTags.push(`448=${currentItem.value}`);
                        shouldProcess = true;
                      }
                      break;

                    case '447': // PartyIDSource
                      group.src = currentItem.value;
                      group.originalTags.push(`447=${currentItem.value}`);
                      shouldProcess = true;
                      break;

                    case '523': // PartySubID
                      group.partySubId = currentItem.value;
                      group.originalTags.push(`523=${currentItem.value}`);
                      shouldProcess = true;
                      break;

                    case '803': // PartySubIDType
                      group.partySubIdType = currentItem.value;
                      group.originalTags.push(`803=${currentItem.value}`);
                      shouldProcess = true;
                      break;

                    case '802': // NoPartySubIDs (related to party block)
                      group.originalTags.push(`802=${currentItem.value}`);
                      shouldProcess = true;
                      break;
                  }

                  if (shouldProcess) {
                    processedIndices.add(i);
                  }
                }

                partyRoleGroups.push(group);
              }
            });

            // Add non-party-role tags to result
            tagSequence.forEach((item, index) => {
              if (!processedIndices.has(index)) {
                result[item.tag] = item.value;
              }
            });

            // Add party role groups with special formatting
            partyRoleGroups.forEach((group, index) => {
              const parts = [];
              if (group.partyId) parts.push(`ID=${group.partyId}`);
              if (group.src) parts.push(`Src="${group.src}"`);
              if (group.partySubId) parts.push(`SubID=${group.partySubId}`);
              if (group.partySubIdType) parts.push(`SubIDType=${group.partySubIdType}`);

              const formattedValue = `R="${group.role}" | ${parts.join(' | ')}`;
              const key = `PartyRole_${index}_[${group.originalTags.join(' ')}]`;

              result[key] = formattedValue;
            });

            return result;
          };

          // Use the global getFieldName function with Party Role support
          const getFieldName = (tag) => {
            // Handle Party Role groups
            if (tag.startsWith('PartyRole_')) {
              const match = tag.match(/PartyRole_\d+_\[(.*?)\]/);
              if (match) {
                return `Party Role Block (${match[1]})`;
              }
              return 'Party Role Block';
            }

            // Use the globally defined function for regular tags
            return window.getFieldName ? window.getFieldName(tag) : `Field(${tag})`;
          };

          const compareMessages = () => {
            setLoading(true);

            try {
              // Parse both messages
              const execObj = parseFIXMessage(execReport, delimiter);
              const tradeObj = parseFIXMessage(tradeCapture, delimiter);

              // Get all fields from both messages
              const execFields = Object.keys(execObj);
              const tradeFields = Object.keys(tradeObj);

              // Find fields only in exec report
              const onlyInExec = execFields.filter(field => !tradeFields.includes(field))
                .map(field => ({
                  field,
                  fieldName: getFieldName(field),
                  value: execObj[field]
                }));

              // Find fields only in trade capture
              const onlyInTrade = tradeFields.filter(field => !execFields.includes(field))
                .map(field => ({
                  field,
                  fieldName: getFieldName(field),
                  value: tradeObj[field]
                }));

              // Find common fields (present in both messages)
              const commonFields = execFields.filter(field => tradeFields.includes(field));

              // Find matching values (same field and same value)
              const matchingValues = commonFields.filter(field => execObj[field] === tradeObj[field])
                .map(field => ({
                  field,
                  fieldName: getFieldName(field),
                  value: execObj[field]
                }));

              // Find same values in different fields, with special handling for Party Role groups
              const differentFieldsSameValue = [];

              // Create a map of values to fields for exec report
              const execValueToField = {};
              execFields.forEach(field => {
                const value = execObj[field];
                if (!execValueToField[value]) {
                  execValueToField[value] = [];
                }
                execValueToField[value].push(field);
              });

              // Check if trade capture has any matching values in different fields
              tradeFields.forEach(tradeField => {
                const tradeValue = tradeObj[tradeField];

                // Skip if this is a common field with the same value (already covered in matchingValues)
                if (commonFields.includes(tradeField) && execObj[tradeField] === tradeValue) {
                  return;
                }

                // Find exec report fields with the same value
                const matchingExecFields = execValueToField[tradeValue] || [];

                matchingExecFields.forEach(execField => {
                  // Skip if it's the same field
                  if (execField === tradeField) return;

                  // Special handling for Party Role comparisons
                  const isExecPartyRole = execField.startsWith('PartyRole_');
                  const isTradePartyRole = tradeField.startsWith('PartyRole_');

                  if (isExecPartyRole || isTradePartyRole) {
                    // For Party Role blocks, we want to show the comparison even if they're similar
                    // because the grouping itself is meaningful
                  }

                  differentFieldsSameValue.push({
                    execField,
                    execFieldName: getFieldName(execField),
                    tradeField,
                    tradeFieldName: getFieldName(tradeField),
                    value: tradeValue
                  });
                });
              });

              setResults({
                onlyInExec,
                onlyInTrade,
                commonFields: commonFields.map(field => ({
                  field,
                  fieldName: getFieldName(field),
                  execValue: execObj[field],
                  tradeValue: tradeObj[field]
                })),
                matchingValues,
                differentFieldsSameValue
              });
            } catch (error) {
              console.error("Error comparing messages:", error);
            } finally {
              setLoading(false);
            }
          };

          const handleAnalyze = () => {
            compareMessages();
          };

          const handleClear = () => {
            setExecReport('');
            setTradeCapture('');
            setResults(null);
          };

          // Example data for demonstration with Party Role blocks
          const loadExampleData = () => {
            setExecReport('8=FIX.4.4|9=253|35=8|49=SENDER|56=TARGET|34=124|52=20240516-14:32:15|37=ORD123456789|11=CL000123|17=EXEC78901|150=F|39=2|55=AAPL|48=037833100|22=1|54=1|38=1000|40=2|44=159.75|31=160.25|32=500|151=500|14=500|6=160.00|60=20240516-14:32:10|1056=80125|75=20240516|1057=Y|448=EXECFIRM|452=1|448=CLIENTFIRM|452=3|10=235|');
            setTradeCapture('8=FIX.4.4|9=289|35=AE|49=SENDER|56=TARGET|34=125|52=20240516-14:35:22|571=TRADE123456|487=0|856=0|828=0|60=20240516-14:32:12|552=1|54=1|37=ORD123456789|11=CL000123|17=EXEC78901|32=500|31=160.25|75=20240516|55=AAPL|48=037833100|22=1|64=20240518|15=USD|30=EXCHANGE|29=1|63=0|150=0|748=0|423=1|1056=80125|1057=N|12=160.00|448=690|452=7|448=CME|452=21|448=CME|452=22|448=SHBDAIRS3|447=C|452=24|802=1|523=1|803=26|448=A-50926|447=H|452=24|381=80125|10=110|');
          };

          return (
            <div className="flex flex-col space-y-6 p-4 bg-gray-50 rounded-lg">
              <div className="text-lg font-semibold text-gray-800">FIX Message Comparison Tool</div>

              <div className="flex flex-col space-y-2">
                <div className="text-sm text-gray-600">Delimiter (| or ^ or other)</div>
                <input
                  type="text"
                  value={delimiter}
                  onChange={(e) => setDelimiter(e.target.value)}
                  className="p-2 border border-gray-300 rounded w-24"
                />
              </div>

              <div className="flex flex-col space-y-2">
                <div className="text-sm text-gray-600">Execution Report (35=8)</div>
                <textarea
                  value={execReport}
                  onChange={(e) => setExecReport(e.target.value)}
                  className="p-2 border border-gray-300 rounded h-32 font-mono text-sm"
                  placeholder="Enter FIX Execution Report (format: tag=value|tag=value)"
                />
              </div>

              <div className="flex flex-col space-y-2">
                <div className="text-sm text-gray-600">Trade Capture Report (35=AE)</div>
                <textarea
                  value={tradeCapture}
                  onChange={(e) => setTradeCapture(e.target.value)}
                  className="p-2 border border-gray-300 rounded h-32 font-mono text-sm"
                  placeholder="Enter FIX Trade Capture Report (format: tag=value|tag=value)"
                />
              </div>

              <div className="flex space-x-4">
                <button
                  onClick={handleAnalyze}
                  className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                  disabled={loading}
                >
                  {loading ? 'Analyzing...' : 'Analyze'}
                </button>
                <button
                  onClick={handleClear}
                  className="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400"
                >
                  Clear
                </button>
                <button
                  onClick={loadExampleData}
                  className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                >
                  Load Example
                </button>
              </div>

              {results && (
                <div className="mt-6 space-y-6">
                  {/* Fields Only in Execution Report */}
                  <div className="border-t pt-4">
                    <div className="text-md font-semibold mb-2">Fields Only in Execution Report</div>
                    {results.onlyInExec.length === 0 ? (
                      <div className="text-gray-500 italic">No unique fields found in Execution Report</div>
                    ) : (
                      <div className="bg-white rounded-lg border p-4 overflow-auto max-h-64">
                        <table className="w-full text-sm">
                          <thead>
                            <tr className="bg-gray-100">
                              <th className="text-left p-2">Tag</th>
                              <th className="text-left p-2">Field Name</th>
                              <th className="text-left p-2">Value</th>
                            </tr>
                          </thead>
                          <tbody>
                            {results.onlyInExec.map((item, index) => (
                              <tr key={index} className={index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}>
                                <td className="p-2">{item.field}</td>
                                <td className={`p-2 ${item.field.startsWith('PartyRole_') ? 'party-role-block' : ''}`}>
                                  {item.fieldName}
                                </td>
                                <td className={`p-2 ${item.field.startsWith('PartyRole_') ? 'party-role-value' : ''}`}>
                                  {item.value}
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    )}
                  </div>

                  {/* Fields Only in Trade Capture Report */}
                  <div className="border-t pt-4">
                    <div className="text-md font-semibold mb-2">Fields Only in Trade Capture Report</div>
                    {results.onlyInTrade.length === 0 ? (
                      <div className="text-gray-500 italic">No unique fields found in Trade Capture Report</div>
                    ) : (
                      <div className="bg-white rounded-lg border p-4 overflow-auto max-h-64">
                        <table className="w-full text-sm">
                          <thead>
                            <tr className="bg-gray-100">
                              <th className="text-left p-2">Tag</th>
                              <th className="text-left p-2">Field Name</th>
                              <th className="text-left p-2">Value</th>
                            </tr>
                          </thead>
                          <tbody>
                            {results.onlyInTrade.map((item, index) => (
                              <tr key={index} className={index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}>
                                <td className="p-2">{item.field}</td>
                                <td className={`p-2 ${item.field.startsWith('PartyRole_') ? 'party-role-block' : ''}`}>
                                  {item.fieldName}
                                </td>
                                <td className={`p-2 ${item.field.startsWith('PartyRole_') ? 'party-role-value' : ''}`}>
                                  {item.value}
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    )}
                  </div>

                  <div className="border-t pt-4">
                    <div className="text-md font-semibold mb-2">Fields Present in Both Messages</div>
                    {results.commonFields.length === 0 ? (
                      <div className="text-gray-500 italic">No common fields found</div>
                    ) : (
                      <div className="bg-white rounded-lg border p-4 overflow-auto max-h-64">
                        <table className="w-full text-sm">
                          <thead>
                            <tr className="bg-gray-100">
                              <th className="text-left p-2">Tag</th>
                              <th className="text-left p-2">Field Name</th>
                              <th className="text-left p-2">Exec Report Value</th>
                              <th className="text-left p-2">Trade Capture Value</th>
                            </tr>
                          </thead>
                          <tbody>
                            {results.commonFields.map((item, index) => (
                              <tr key={index} className={index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}>
                                <td className="p-2">{item.field}</td>
                                <td className={`p-2 ${item.field.startsWith('PartyRole_') ? 'party-role-block' : ''}`}>
                                  {item.fieldName}
                                </td>
                                <td className={`p-2 ${item.field.startsWith('PartyRole_') ? 'party-role-value' : ''}`}>
                                  {item.execValue}
                                </td>
                                <td className={`p-2 ${item.field.startsWith('PartyRole_') ? 'party-role-value' : ''}`}>
                                  {item.tradeValue}
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    )}
                  </div>

                  <div className="border-t pt-4">
                    <div className="text-md font-semibold mb-2">Matching Values (Same Field, Same Value)</div>
                    {results.matchingValues.length === 0 ? (
                      <div className="text-gray-500 italic">No matching values found</div>
                    ) : (
                      <div className="bg-white rounded-lg border p-4 overflow-auto max-h-64">
                        <table className="w-full text-sm">
                          <thead>
                            <tr className="bg-gray-100">
                              <th className="text-left p-2">Tag</th>
                              <th className="text-left p-2">Field Name</th>
                              <th className="text-left p-2">Value</th>
                            </tr>
                          </thead>
                          <tbody>
                            {results.matchingValues.map((item, index) => (
                              <tr key={index} className={index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}>
                                <td className="p-2">{item.field}</td>
                                <td className={`p-2 ${item.field.startsWith('PartyRole_') ? 'party-role-block' : ''}`}>
                                  {item.fieldName}
                                </td>
                                <td className={`p-2 ${item.field.startsWith('PartyRole_') ? 'party-role-value' : ''}`}>
                                  {item.value}
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    )}
                  </div>

                  <div className="border-t pt-4">
                    <div className="text-md font-semibold mb-2">Same Values in Different Fields</div>
                    {results.differentFieldsSameValue.length === 0 ? (
                      <div className="text-gray-500 italic">No same values in different fields found</div>
                    ) : (
                      <div className="bg-white rounded-lg border p-4 overflow-auto max-h-64">
                        <table className="w-full text-sm">
                          <thead>
                            <tr className="bg-gray-100">
                              <th className="text-left p-2">Value</th>
                              <th className="text-left p-2">Execution Report</th>
                              <th className="text-left p-2">Trade Capture Report</th>
                            </tr>
                          </thead>
                          <tbody>
                            {results.differentFieldsSameValue.map((item, index) => (
                              <tr key={index} className={index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}>
                                <td className={`p-2 font-mono ${item.execField.startsWith('PartyRole_') || item.tradeField.startsWith('PartyRole_') ? 'party-role-value' : ''}`}>
                                  {item.value}
                                </td>
                                <td className="p-2">
                                  <div className={`font-bold ${item.execField.startsWith('PartyRole_') ? 'party-role-block' : ''}`}>
                                    {item.execFieldName} ({item.execField})
                                  </div>
                                </td>
                                <td className="p-2">
                                  <div className={`font-bold ${item.tradeField.startsWith('PartyRole_') ? 'party-role-block' : ''}`}>
                                    {item.tradeFieldName} ({item.tradeField})
                                  </div>
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Render the React component
        ReactDOM.render(
            <FIXMessageComparison />,
            document.getElementById('root')
        );
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>